import org.tiqr.authenticator.buildsrc.Versions
import org.tiqr.authenticator.buildsrc.Libs

apply plugin: 'com.android.library'
apply plugin: 'kotlin-android'
apply plugin: 'kotlin-parcelize'
apply plugin: 'kotlin-kapt'
apply plugin: 'dagger.hilt.android.plugin'

android {
    compileSdkVersion Versions.compileSdkVersion
    buildToolsVersion Versions.buildToolsVersion

    defaultConfig {
        minSdkVersion Versions.minSdkVersion
        targetSdkVersion Versions.targetSdkVersion

        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
        consumerProguardFiles 'consumer-rules.pro'

        buildConfigField "String", "TOKEN_EXCHANGE_BASE_URL", "\"https://tx.tiqr.org/\""

        buildConfigField "String", "BASE_URL", "\"https://demo.tiqr.org\""
        buildConfigField "int", "PROTOCOL_VERSION", "2"
        buildConfigField "boolean", "PROTOCOL_COMPATIBILITY_MODE", "true"

        buildConfigField "String", "TIQR_ENROLL_SCHEME", "\"${project.schemeEnroll}://\""
        buildConfigField "String", "TIQR_AUTH_SCHEME", "\"${project.schemeAuth}://\""
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }

    buildFeatures {
        dataBinding = true
    }

    kapt {
        correctErrorTypes = true
        useBuildCache = true

        javacOptions {
            option("-Xmaxerrs", 1000)
        }

        arguments {
            arg("room.schemaLocation", "$projectDir/schemas".toString())
            arg("room.incremental", "true")
        }
    }

    compileOptions {
        sourceCompatibility = 1.8
        targetCompatibility = 1.8

        kotlinOptions {
            jvmTarget = "1.8"
            freeCompilerArgs = ["-Xinline-classes"]
        }
    }
}

dependencies {
    implementation Libs.Kotlin.stdlib
    implementation Libs.Kotlin.Coroutines.core
    implementation Libs.Kotlin.Coroutines.android
    implementation Libs.AndroidX.core
    implementation Libs.AndroidX.Lifecycle.liveData
    implementation Libs.AndroidX.Lifecycle.viewmodel
    implementation Libs.Google.material

    implementation Libs.Hilt.android
    kapt Libs.Hilt.compiler

    api Libs.OkHttp.okhttp
    api Libs.OkHttp.logging

    api Libs.Retrofit.retrofit
    implementation Libs.Retrofit.converterMoshi
    implementation Libs.Retrofit.converterScalars

    api Libs.Moshi.moshi
    kapt Libs.Moshi.codegen

    api Libs.AndroidX.Room.runtime
    implementation Libs.AndroidX.Room.ktx
    implementation Libs.AndroidX.Room.sqlite
    kapt Libs.AndroidX.Room.compiler

    api Libs.Timber.timber

    androidTestImplementation Libs.Kotlin.Coroutines.test
    testImplementation Libs.Testing.jUnit
    androidTestImplementation Libs.Testing.jUnitAndroidx
    androidTestImplementation Libs.Testing.epsresso
}
